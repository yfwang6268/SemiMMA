test_that("SemiMMA handles basic input", {
  input_data <- matrix(c(
    -0.03440099, 0.06367074, -0.21049266, 0.4788932, NA, NA, NA, NA, NA, NA, 104,
    -1.16406963, 0.26568505, -0.44015128, 0.5150587, 4.2336802, 1.4042320, 1.638425, 1.5303653, -4.0300, 0.15443702, 67,
    -0.95071656, 0.18560684, -0.65352462, 0.4304495, 0.5947071, 0.5168497, 2.204145, 1.0330216, NA, NA, 107,
    -0.34446409, 0.06311055, -1.05975991, 0.3079199, 3.3234680, 0.4977187, 1.206932, 0.3096928, -3.5800, 0.11172501, 375,
    -0.93609301, 0.41891620, NA, NA, 3.3127864, 1.4117737, NA, NA, NA, NA, 32,
    -0.08004262, 0.05847029, -0.20067047, 0.2258541, 2.1202635, 0.5686241, 1.386294, 1.0954452, NA, NA, 80,
    -0.25367235, 0.09848534, -1.22807084, 0.6205901, 3.2717393, 0.9944030, 1.074515, 0.6294798, NA, NA, 83,
    -0.95551244, 0.26794567, NA, NA, NA, NA, NA, NA, NA, NA, 60,
    -0.23361443, 0.06903660, -0.34830719, 0.3398385, 2.8332133, 0.7090452, 1.791759, 0.6018490, -1.6446, 0.04108443, 150,
    -0.21791226, 0.13529018, -0.78845836, 0.6605787, NA, NA, NA, NA, NA, NA, 63,
    -0.56798345, 0.16625485, 0.00000000, 0.9672048, NA, NA, 1.945910, 1.4910448, NA, NA, 62,
    -0.29334742, 0.07964372, -0.91629073, 0.5627322, 2.8903718, 1.0110501, NA, NA, -4.2400, 0.15908047, 120,
    NA, NA, 0.91629073, 0.7071068, NA, NA, NA, NA, NA, NA, 20,
    NA, NA, -1.60943791, 1.0488138, 3.4339872, 1.4033097, NA, NA, NA, NA, 40,
    NA, NA, -0.05715888, 0.4290636, 3.8357308, 1.4154165, 2.650892, 1.0141698, NA, NA, 105,
    NA, NA, NA, NA, NA, NA, NA, NA, -3.3000, 1.09805028, 49
  ), nrow = 16, byrow = TRUE)

  # Add column names
  n = input_data[,ncol(input_data)]
  y = input_data[,seq(1,ncol(input_data)-1,2)]
  s = input_data[,seq(2,ncol(input_data)-1,2)]
  s_imputed <- impute_within_study_sd(s, n)
  result <- SemiMMA(y,s,n)
  # expect_true(sum(is.na(s_imputed)), as.numeric(0))
  expect_equal(length(result), 10)
})
